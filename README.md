# Colored-PetriNets
Simple Petri Net with Colored Markers


The provided Python code is implementing and visualizing a **Colored Petri Net (CPN)** for an **order processing system** using the **Snakes** library for Petri net modeling, and **Graphviz** for visual representation. Hereâ€™s a detailed explanation of the code:

### 1. **Library Imports**:
   - **`snakes.nets`**: This is the main library for creating Petri nets in Python using Snakes. It provides classes such as `PetriNet`, `Place`, `Transition`, and `Variable`, which are used to define and manipulate the net's structure.
   - **`graphviz`**: A Python library for visualizing graphs, which helps in generating a graphical representation of the Petri net.

### 2. **Creating the Petri Net**:
   ```python
   net = PetriNet('Order Processing System')
   ```
   This creates a new Petri net named **Order Processing System**. The `PetriNet` class is used to manage the places, transitions, and connections between them.

### 3. **Defining Places**:
   ```python
   net.add_place(Place('Order_Queue', [Token(('C001', 'AssemblyRequired')), Token(('C002', 'Simple'))]))
   net.add_place(Place('Preparation', []))
   net.add_place(Place('Delivery', []))
   ```
   - **`Order_Queue`**: This place holds two tokens representing orders. One token for a customer with ID `C001` and an order that requires assembly (`AssemblyRequired`), and another for a customer with ID `C002` and a simple order (`Simple`). Each token is a tuple with customer ID and order type.
   - **`Preparation`** and **`Delivery`**: These places are initially empty and will receive tokens as transitions are fired.

### 4. **Defining Transitions**:
   ```python
   net.add_transition(Transition('Place_Order'))
   net.add_transition(Transition('Prepare_Order'))
   net.add_transition(Transition('Deliver_Order'))
   ```
   Three transitions are created:
   - **`Place_Order`**: This transition represents the action of placing an order from the queue.
   - **`Prepare_Order`**: This represents preparing an order that needs assembly.
   - **`Deliver_Order`**: This represents the final step of delivering the order.

### 5. **Defining Input and Output Arcs**:
   - **`add_input()`**: Defines arcs from places to transitions.
   - **`add_output()`**: Defines arcs from transitions to places.

   Example:
   ```python
   net.add_input('Order_Queue', 'Place_Order', MultiArc([Variable('customer_id'), Variable('order_type')]))
   net.add_output('Preparation', 'Place_Order', Variable('customer_id'))
   net.add_output('Delivery', 'Place_Order', Variable('customer_id'))
   ```

   - **Input to `Place_Order`**: Tokens (orders) from `Order_Queue` move to the `Place_Order` transition. The token's `customer_id` and `order_type` are captured as variables.
   - **Output of `Place_Order`**: Depending on the order type, tokens are routed to either `Preparation` (for assembly-required orders) or directly to `Delivery` (for simple orders).

   The other transitions, `Prepare_Order` and `Deliver_Order`, have similar input-output configurations.

### 6. **Adding a Guard Condition**:
   ```python
   net.transition('Place_Order').guard = Expression('order_type == "AssemblyRequired" or order_type == "Simple"')
   ```
   This guard condition ensures that only tokens with an `order_type` of `"AssemblyRequired"` or `"Simple"` can trigger the `Place_Order` transition. Guards act as filters to control when a transition is allowed to fire.

### 7. **Visualizing the Petri Net**:
   ```python
   def visualize_petri_net(net):
       dot = graphviz.Digraph()
       
       # Add places (as circles) and transitions (as boxes)
       for place in net.place():
           dot.node(place.name, shape="circle", label=place.name)
       for transition in net.transition():
           dot.node(transition.name, shape="box", label=transition.name)

       # Connect places and transitions with arcs
       for transition in net.transition():
           for place, arc in transition.input():
               dot.edge(place.name, transition.name, label="input")
           for place, arc in transition.output():
               dot.edge(transition.name, place.name, label="output")

       return dot
   ```

   - **`dot.node()`**: Defines nodes (vertices) in the graph. Places are represented as circles, and transitions are represented as boxes.
   - **Arcs**: Arcs are drawn from places to transitions (`input()`) and from transitions to places (`output()`).

   The `visualize_petri_net` function generates a **Graphviz** diagram, showing the structure of the Petri net.

### 8. **Rendering the Petri Net**:
   ```python
   petri_net_viz = visualize_petri_net(net)
   petri_net_viz.render('petri_net_output', format='png', cleanup=True)
   ```

   This renders the Petri net to an output file in PNG format. The `cleanup=True` argument removes temporary files generated by Graphviz after rendering the final image.

### Summary:
- The code models an order processing system where orders (tokens) flow through various stages (places: `Order_Queue`, `Preparation`, `Delivery`) and are processed by transitions (`Place_Order`, `Prepare_Order`, `Deliver_Order`).
- **Colored tokens** are used to differentiate between different customer orders.
- **Guards** are applied to control the flow of tokens based on their attributes.
- The **Graphviz** library is used to visualize the Petri net as a directed graph, making it easier to understand how tokens move through the system.

This code is a good example of using Petri nets to model real-world systems like workflow or order processing systems, especially when there are multiple paths based on different conditions (order types).
